---
description:
globs:
alwaysApply: false
---
# 用户班组调动与统计数据处理规则

当用户调动班组时，系统采用以下原则处理数据统计：

## 基本原则

- **历史建议归属不变**：用户提交建议时，系统会记录当时用户所属的班组。即使用户后来被调到其他班组，历史建议仍然归属于提交时的班组。
- **统计数据以建议记录为准**：所有统计报表均以建议表中记录的班组字段(`Suggestion.team`)为准，而不使用用户当前的班组信息。

## 技术实现

- 建议表(`Suggestion`)中的`team`字段记录了提交建议时用户所属的班组。
- 统计查询直接使用`Suggestion.team`字段进行分组和计算，不依赖用户表中的当前班组。
- 用户调动班组时，系统会在日志中记录班组变更情况，但不会修改历史建议的归属。

## 数据模型

- **建议表(Suggestion)**：
  ```javascript
  {
    ...
    submitter: ObjectId, // 提交者ID，引用User表
    team: String,        // 提交时用户所属的班组
    ...
  }
  ```

- **用户表(User)**：
  ```javascript
  {
    ...
    team: String,  // 用户当前班组
    ...
  }
  ```

## 注意事项

1. 报表查看权限依然基于用户的当前班组和角色
2. 值班主任只能看到当前所在班组的建议
3. 班组人员调动后，将无法查看历史所在班组提交的建议
4. 统计报表中，班组排名和成绩反映的是班组历史总体表现，包含了已调出人员的贡献

## 未来优化方向

未来可考虑增加以下功能：

1. 添加用户班组变更历史记录表
2. 在统计报表中增加筛选条件，允许按"当前人员"或"历史全部"进行统计
3. 为调动班组的用户提供查看历史所在班组建议的权限
